<!DOCTYPE html>
<html>
<head>
    <title>Universal WASM Runner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body { background: #1a1a1a; color: #00ff00; font-family: monospace; padding: 20px; }
        #drop-zone { border: 2px dashed #00ff00; padding: 50px; text-align: center; cursor: pointer; }
        #output { background: #000; border: 1px solid #333; height: 300px; overflow-y: scroll; padding: 10px; margin-top: 20px; white-space: pre; }
    </style>
</head>
<body>
    <h1>Universal WASM Loader</h1>
    <div id="drop-zone">Drop your build artifact (.zip) here</div>
    <div id="output">System ready... awaiting binary.</div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const output = document.getElementById('output');

        dropZone.onclick = () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.zip';
            input.onchange = e => handleZip(e.target.files[0]);
            input.click();
        };

        async function handleZip(file) {
            output.textContent = "Unzipping...";
            const zip = await JSZip.loadAsync(file);
            
            // 1. Find the .wasm and .js files
            const wasmFile = Object.keys(zip.files).find(f => f.endsWith('.wasm'));
            const jsFile = Object.keys(zip.files).find(f => f.endsWith('.js'));

            if (!wasmFile) {
                output.textContent += "\nError: No .wasm file found in zip!";
                return;
            }

            output.textContent += `\nFound: ${wasmFile}`;

            // 2. Load the binary data
            const wasmBytes = await zip.files[wasmFile].async("uint8array");

            // 3. Execution Logic
            if (jsFile) {
                output.textContent += "\nDetected Emscripten/C# glue code. Executing...";
                // For .NET or Emscripten, we usually have to inject the script tag
                const jsContent = await zip.files[jsFile].async("string");
                const script = document.createElement('script');
                script.text = jsContent;
                document.body.appendChild(script);
            } else {
                output.textContent += "\nStandalone WASM detected. Running directly...";
                const { instance } = await WebAssembly.instantiate(wasmBytes, {
                    env: { print: (ptr) => console.log("WASM Log") }
                });
                // Call main if it exists
                if (instance.exports.main) instance.exports.main();
            }
        }
    </script>
</body>
</html>
